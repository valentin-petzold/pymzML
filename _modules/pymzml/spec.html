<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pymzml.spec &mdash; pymzML 2.5.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=0bbe9fa5"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            pymzML
          </a>
              <div class="version">
                2.5.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quick_start.html">2. Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">3. pymzML module content</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">4. Examples and Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../suppl_material.html">5. Supplemental Material</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pymzML</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pymzml.spec</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pymzml.spec</h1><div class="highlight"><pre>
<span></span><span class="ch">#!usr/bin/env python3</span>
<span class="c1"># -*- coding: latin-1 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The spectrum class offers a python object for mass spectrometry data.</span>
<span class="sd">The spectrum object holds the basic information of the spectrum and offers</span>
<span class="sd">methods to interrogate properties of the spectrum.</span>
<span class="sd">Data, i.e. mass over charge (m/z) and intensity decoding is performed on demand</span>
<span class="sd">and can be accessed via their properties, e.g. :py:attr:`~pymzml.spec.Spectrum.peaks`.</span>

<span class="sd">The Spectrum class is used in the :py:class:`~pymzml.run.Reader` class.</span>
<span class="sd">There each spectrum is accessible as a spectrum object.</span>

<span class="sd">Theoretical spectra can also be created using the setter functions.</span>
<span class="sd">For example, m/z values, intensities, and peaks can be set by the</span>
<span class="sd">corresponding properties: :py:attr:`pymzml.spec.Spectrum.mz`,</span>
<span class="sd">:py:attr:`pymzml.spec.Spectrum.i`, :py:attr:`pymzml.spec.Spectrum.peaks`.</span>

<span class="sd">Similar to the spectrum class, the chromatogram class allows interrogation</span>
<span class="sd">with profile data (time, intensity) in an total ion chromatogram.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Python mzML module - pymzml</span>
<span class="c1"># Copyright (C) 2010-2019 M. KÃ¶sters, C. Fufezan</span>
<span class="c1">#     The MIT License (MIT)</span>

<span class="c1">#     Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="c1">#     of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="c1">#     in the Software without restriction, including without limitation the rights</span>
<span class="c1">#     to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="c1">#     copies of the Software, and to permit persons to whom the Software is</span>
<span class="c1">#     furnished to do so, subject to the following conditions:</span>

<span class="c1">#     The above copyright notice and this permission notice shall be included in all</span>
<span class="c1">#     copies or substantial portions of the Software.</span>

<span class="c1">#     THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="c1">#     IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="c1">#     FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="c1">#     AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="c1">#     LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="c1">#     OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<span class="c1">#     SOFTWARE.</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">ElementTree</span>
<span class="kn">import</span> <span class="nn">zlib</span>
<span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64decode</span> <span class="k">as</span> <span class="n">b64dec</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span> <span class="k">as</span> <span class="n">ddict</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span> <span class="k">as</span> <span class="n">itemgetter</span>
<span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">unpack</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">DECON_DEP</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="kn">from</span> <span class="nn">ms_deisotope.deconvolution</span> <span class="kn">import</span> <span class="n">deconvolute_peaks</span>
    <span class="kn">from</span> <span class="nn">ms_peak_picker</span> <span class="kn">import</span> <span class="n">simple_peak</span>
<span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">ModuleNotFoundError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">DECON_DEP</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">pass</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">regex_patterns</span>
<span class="kn">from</span> <span class="nn">.decoder</span> <span class="kn">import</span> <span class="n">MSDecoder</span>
<span class="kn">from</span> <span class="nn">.obo</span> <span class="kn">import</span> <span class="n">OboTranslator</span>

<span class="n">PROTON</span> <span class="o">=</span> <span class="mf">1.00727646677</span>
<span class="n">ISOTOPE_AVERAGE_DIFFERENCE</span> <span class="o">=</span> <span class="mf">1.002</span>


<div class="viewcode-block" id="MS_Spectrum">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.MS_Spectrum">[docs]</a>
<span class="k">class</span> <span class="nc">MS_Spectrum</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    General spectrum class for data handling.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_read_accessions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set all required variables for this spectrum.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accessions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">iter</span><span class="p">():</span>
            <span class="n">accession</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;accession&quot;</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">accession</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">accessions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">accession</span>
        <span class="k">if</span> <span class="s2">&quot;profile spectrum&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accessions</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="MS_Spectrum.get_element_by_name">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.MS_Spectrum.get_element_by_name">[docs]</a>
    <span class="k">def</span> <span class="nf">get_element_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get element from the original tree by it&#39;s unit name.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (str): unit name of the mzml element.</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            obo_version (str, optional): obo version number.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">iterator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">iter</span><span class="p">()</span>
        <span class="n">return_ele</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ele</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">return_ele</span> <span class="o">=</span> <span class="n">ele</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">return_ele</span></div>


<div class="viewcode-block" id="MS_Spectrum.get_element_by_path">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.MS_Spectrum.get_element_by_path">[docs]</a>
    <span class="k">def</span> <span class="nf">get_element_by_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hooks</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find elements in spectrum by its path.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            hooks (list): list of parent elements for the target element.</span>

<span class="sd">        Returns:</span>
<span class="sd">            elements (list): list of XML objects</span>
<span class="sd">            found in the path</span>

<span class="sd">        Example:</span>

<span class="sd">            To access cvParam in scanWindow tag:</span>

<span class="sd">            &gt;&gt;&gt; spec.get_element_by_path([&#39;scanList&#39;, &#39;scan&#39;, &#39;scanWindowList&#39;,</span>
<span class="sd">            ...     &#39;scanWindow&#39;, &#39;cvParam&#39;])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">return_ele</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hooks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">path_array</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">hook</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
                <span class="n">path_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{ns}{hook}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">,</span> <span class="n">hook</span><span class="o">=</span><span class="n">hook</span><span class="p">))</span>
            <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_array</span><span class="p">)</span>
            <span class="n">return_ele</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">return_ele</span></div>


    <span class="k">def</span> <span class="nf">_register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decoded_tuple</span><span class="p">):</span>
        <span class="n">d_type</span><span class="p">,</span> <span class="n">array</span> <span class="o">=</span> <span class="n">decoded_tuple</span>
        <span class="k">if</span> <span class="n">d_type</span> <span class="o">==</span> <span class="s2">&quot;mz&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mz</span> <span class="o">=</span> <span class="n">array</span>
        <span class="k">elif</span> <span class="n">d_type</span> <span class="o">==</span> <span class="s2">&quot;i&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_i</span> <span class="o">=</span> <span class="n">array</span>
        <span class="k">elif</span> <span class="n">d_type</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="n">array</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unknown data Type (</span><span class="si">{0}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d_type</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_get_encoding_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the correct parameter for decoding and return them as tuple.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            array_type (str): data type of the array, e.g. m/z, time or</span>
<span class="sd">                intensity</span>
<span class="sd">        Returns:</span>
<span class="sd">            data (str)           : encoded data</span>
<span class="sd">            comp (str)           : compression method</span>
<span class="sd">            d_type (str)         : data type</span>
<span class="sd">            d_array_length (str) : length of the data array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">numpress_encoding</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">b_data_string</span> <span class="o">=</span> <span class="s2">&quot;./</span><span class="si">{ns}</span><span class="s2">binaryDataArrayList/</span><span class="si">{ns}</span><span class="s2">binaryDataArray/</span><span class="si">{ns}</span><span class="s2">cvParam[@name=&#39;</span><span class="si">{name}</span><span class="s2">&#39;]/..&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">array_type</span>
        <span class="p">)</span>
        <span class="n">float_type_string</span> <span class="o">=</span> <span class="s2">&quot;./</span><span class="si">{ns}</span><span class="s2">cvParam[@accession=&#39;</span><span class="si">{Acc}</span><span class="s2">&#39;]&quot;</span>

        <span class="n">b_data_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">b_data_string</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">b_data_array</span><span class="p">:</span>
            <span class="c1"># non-standard data array</span>
            <span class="n">b_data_string</span> <span class="o">=</span> <span class="s2">&quot;./</span><span class="si">{ns}</span><span class="s2">binaryDataArrayList/</span><span class="si">{ns}</span><span class="s2">binaryDataArray/</span><span class="si">{ns}</span><span class="s2">cvParam[@value=&#39;</span><span class="si">{value}</span><span class="s2">&#39;]/..&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">array_type</span>
            <span class="p">)</span>
            <span class="n">b_data_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">b_data_string</span><span class="p">)</span>

        <span class="n">comp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">b_data_array</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cvParam</span> <span class="ow">in</span> <span class="n">b_data_array</span><span class="o">.</span><span class="n">iterfind</span><span class="p">(</span><span class="s2">&quot;./</span><span class="si">{ns}</span><span class="s2">cvParam&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)):</span>
                <span class="k">if</span> <span class="s2">&quot;compression&quot;</span> <span class="ow">in</span> <span class="n">cvParam</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="s2">&quot;numpress&quot;</span> <span class="ow">in</span> <span class="n">cvParam</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                        <span class="n">numpress_encoding</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">comp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cvParam</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">))</span>
                <span class="n">d_array_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;defaultArrayLength&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">numpress_encoding</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># 32-bit float</span>
                    <span class="n">d_type</span> <span class="o">=</span> <span class="n">b_data_array</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                        <span class="n">float_type_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">,</span>
                            <span class="n">Acc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">obo_translator</span><span class="p">[</span><span class="s2">&quot;32-bit float&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                        <span class="p">)</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># 64-bit Float</span>
                        <span class="n">d_type</span> <span class="o">=</span> <span class="n">b_data_array</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                            <span class="n">float_type_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">,</span>
                                <span class="n">Acc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">obo_translator</span><span class="p">[</span><span class="s2">&quot;64-bit float&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                            <span class="p">)</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># 32-bit integer</span>
                            <span class="n">d_type</span> <span class="o">=</span> <span class="n">b_data_array</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                                <span class="n">float_type_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">,</span>
                                    <span class="n">Acc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">obo_translator</span><span class="p">[</span><span class="s2">&quot;32-bit integer&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                                <span class="p">)</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="c1"># 64-bit integer</span>
                                <span class="n">d_type</span> <span class="o">=</span> <span class="n">b_data_array</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                                    <span class="n">float_type_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                        <span class="n">ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">,</span>
                                        <span class="n">Acc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">obo_translator</span><span class="p">[</span><span class="s2">&quot;64-bit integer&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                                    <span class="p">)</span>
                                <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="c1"># null-terminated ASCII string</span>
                                <span class="n">d_type</span> <span class="o">=</span> <span class="n">b_data_array</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                                    <span class="n">float_type_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                        <span class="n">ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">,</span>
                                        <span class="n">Acc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">obo_translator</span><span class="p">[</span>
                                            <span class="s2">&quot;null-terminated ASCII string&quot;</span>
                                        <span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                                    <span class="p">)</span>
                                <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># compression is numpress, dont need data type here</span>
                <span class="n">d_type</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">b_data_array</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;./</span><span class="si">{ns}</span><span class="s2">binary&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">text</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">d_array_length</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">d_type</span> <span class="o">=</span> <span class="s2">&quot;64-bit float&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">d_array_length</span><span class="p">,</span> <span class="n">d_type</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">measured_precision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the measured and internal precision.</span>

<span class="sd">        Returns:</span>
<span class="sd">            value (float): measured Precision (e.g. 5e-6)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_measured_precision</span>

    <span class="nd">@measured_precision</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">measured_precision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measured_precision</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_precision</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">50000.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">value</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)))</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_decode_to_numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">d_array_length</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">comp</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decode the b64 encoded and packed strings from data as numpy arrays.</span>

<span class="sd">        Returns:</span>
<span class="sd">            data (np.ndarray): Returns the unpacked data as a tuple. Returns an</span>
<span class="sd">                               empty list if there is no raw data or raises an</span>
<span class="sd">                               exception if data could not be decoded.</span>

<span class="sd">        d_array_length just for compatibility</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out_data</span> <span class="o">=</span> <span class="n">b64dec</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out_data</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;zlib&quot;</span> <span class="ow">in</span> <span class="n">comp</span> <span class="ow">or</span> <span class="s2">&quot;zlib compression&quot;</span> <span class="ow">in</span> <span class="n">comp</span><span class="p">:</span>
                <span class="n">out_data</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">out_data</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="s2">&quot;ms-np-linear&quot;</span> <span class="ow">in</span> <span class="n">comp</span>
                <span class="ow">or</span> <span class="s2">&quot;ms-np-pic&quot;</span> <span class="ow">in</span> <span class="n">comp</span>
                <span class="ow">or</span> <span class="s2">&quot;ms-np-slof&quot;</span> <span class="ow">in</span> <span class="n">comp</span>
                <span class="ow">or</span> <span class="s2">&quot;MS-Numpress linear prediction compression&quot;</span> <span class="ow">in</span> <span class="n">comp</span>
                <span class="ow">or</span> <span class="s2">&quot;MS-Numpress short logged float compression&quot;</span> <span class="ow">in</span> <span class="n">comp</span>
            <span class="p">):</span>
                <span class="n">out_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decodeNumpress_to_array</span><span class="p">(</span><span class="n">out_data</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;32-bit float&quot;</span><span class="p">:</span>
                <span class="c1"># one character code may be sufficient too (f)</span>
                <span class="n">f_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
                <span class="n">out_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">out_data</span><span class="p">,</span> <span class="n">f_type</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;64-bit float&quot;</span><span class="p">:</span>
                <span class="c1"># one character code may be sufficient too (d)</span>
                <span class="n">f_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
                <span class="n">out_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">out_data</span><span class="p">,</span> <span class="n">f_type</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;32-bit integer&quot;</span><span class="p">:</span>
                <span class="c1"># one character code may be sufficient too (i)</span>
                <span class="n">i_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span>
                <span class="n">out_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">out_data</span><span class="p">,</span> <span class="n">i_type</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;64-bit integer&quot;</span><span class="p">:</span>
                <span class="c1"># one character code may be sufficient too (l)</span>
                <span class="n">i_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span>
                <span class="n">out_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">out_data</span><span class="p">,</span> <span class="n">i_type</span><span class="p">)</span>
            <span class="c1"># TODO elif data_type == &quot;null-terminated ASCII string&quot;:</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported data type: </span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">return</span> <span class="n">out_data</span>

    <span class="k">def</span> <span class="nf">_decode_to_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">d_array_length</span><span class="p">,</span> <span class="n">float_type</span><span class="p">,</span> <span class="n">comp</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decode b64 encoded and packed strings.</span>

<span class="sd">        Returns:</span>
<span class="sd">            data (tuple): Returns the unpacked data as a tuple.</span>
<span class="sd">                Returns an empty list if there is no raw data or</span>
<span class="sd">                raises an exception if data could not be decoded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dec_data</span> <span class="o">=</span> <span class="n">b64dec</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dec_data</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;zlib&quot;</span> <span class="ow">in</span> <span class="n">comp</span> <span class="ow">or</span> <span class="s2">&quot;zlib compression&quot;</span> <span class="ow">in</span> <span class="n">comp</span><span class="p">:</span>
                <span class="n">dec_data</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">dec_data</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;ms-np-linear&quot;</span><span class="p">,</span> <span class="s2">&quot;ms-np-pic&quot;</span><span class="p">,</span> <span class="s2">&quot;ms-np-slof&quot;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">comp</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_decodeNumpress</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span>
            <span class="c1"># else:</span>
            <span class="c1">#     print(</span>
            <span class="c1">#         &#39;New data compression ({0}) detected, cant decompress&#39;.format(</span>
            <span class="c1">#             comp</span>
            <span class="c1">#         )</span>
            <span class="c1">#     )</span>
            <span class="c1">#     sys.exit(1)</span>
            <span class="k">if</span> <span class="n">float_type</span> <span class="o">==</span> <span class="s2">&quot;32-bit float&quot;</span><span class="p">:</span>
                <span class="n">f_type</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span>
            <span class="k">elif</span> <span class="n">float_type</span> <span class="o">==</span> <span class="s2">&quot;64-bit float&quot;</span><span class="p">:</span>
                <span class="n">f_type</span> <span class="o">=</span> <span class="s2">&quot;d&quot;</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{endian}{array_length}{float_type}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">endian</span><span class="o">=</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="n">array_length</span><span class="o">=</span><span class="n">d_array_length</span><span class="p">,</span> <span class="n">float_type</span><span class="o">=</span><span class="n">f_type</span>
            <span class="p">)</span>
            <span class="n">ret_data</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">dec_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">ret_data</span>

    <span class="k">def</span> <span class="nf">_decodeNumpress_to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">compression</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decode golomb-rice encoded data (aka numpress encoded data).</span>

<span class="sd">        Arguments:</span>
<span class="sd">            data (str)        : Encoded data string</span>
<span class="sd">            compression (str) : Decompression algorithm to be used</span>
<span class="sd">                (valid are &#39;ms-np-linear&#39;, &#39;ms-np-pic&#39;, &#39;ms-np-slof&#39;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            array (list): Returns the unpacked data as an array of floats.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">comp_ms_tags</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">calling_instance</span><span class="o">.</span><span class="n">OT</span><span class="p">[</span><span class="n">comp</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">compression</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;MS:1002312&quot;</span> <span class="ow">in</span> <span class="n">comp_ms_tags</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">MSDecoder</span><span class="o">.</span><span class="n">decode_linear</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;MS:1002313&quot;</span> <span class="ow">in</span> <span class="n">comp_ms_tags</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">MSDecoder</span><span class="o">.</span><span class="n">decode_pic</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;MS:1002314&quot;</span> <span class="ow">in</span> <span class="n">comp_ms_tags</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">MSDecoder</span><span class="o">.</span><span class="n">decode_slof</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_median</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute median.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            data (list): list of numeric values</span>

<span class="sd">        Returns:</span>
<span class="sd">            median (float): median of the input data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<div class="viewcode-block" id="MS_Spectrum.to_string">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.MS_Spectrum.to_string">[docs]</a>
    <span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;latin-1&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;xml&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return string representation of the xml element the</span>
<span class="sd">        spectrum was initialized with.</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            encoding (str) : text encoding of the returned string.\n</span>
<span class="sd">                             Default is latin-1.</span>
<span class="sd">            method (str)   : text format of the returned string.\n</span>
<span class="sd">                             Default is xml, alternatives are html and text.</span>

<span class="sd">        Returns:</span>
<span class="sd">            element (str)  : xml string representation of the spectrum.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Spectrum">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.Spectrum">[docs]</a>
<span class="k">class</span> <span class="nc">Spectrum</span><span class="p">(</span><span class="n">MS_Spectrum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spectrum class which inherits from class :py:attr:`pymzml.spec.MS_Spectrum`</span>

<span class="sd">    Arguments:</span>
<span class="sd">        element (xml.etree.ElementTree.Element): spectrum as xml element</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        measured_precision (float): in ppm, i.e. 5e-6 equals to 5 ppm.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">element</span><span class="o">=</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">measured_precision</span><span class="o">=</span><span class="mf">5e-6</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">obo_version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;_centroided_peaks&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_centroided_peaks_sorted_by_i&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_deconvoluted_peaks&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_extreme_values&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_i&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_ID&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_id_dict&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_index&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_measured_precision&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_peaks&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_profile&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_reprofiled_peaks&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_t_mass_set&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_t_mz_set&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_time&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_transformed_mass_with_error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_transformed_mz_with_error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_transformed_peaks&quot;</span> <span class="s2">&quot;calling_instance&quot;</span> <span class="s2">&quot;element&quot;</span><span class="p">,</span>
            <span class="s2">&quot;internal_precision&quot;</span> <span class="s2">&quot;noise_level_estimate&quot;</span><span class="p">,</span>
            <span class="s2">&quot;selected_precursors&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_centroided_peaks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_centroided_peaks_sorted_by_i</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extreme_values</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_i</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_id_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ms_level</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mz</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;raw&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;centroided&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;reprofiled&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;deconvoluted&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selected_precursors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reprofiled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reprofiled_peaks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time_unit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time_in_minutes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t_mass_set</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t_mz_set</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_TIC</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_precursors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transformed_mass_with_error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transformed_mz_with_error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transformed_peaks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obo_translator</span> <span class="o">=</span> <span class="n">OboTranslator</span><span class="o">.</span><span class="n">from_cache</span><span class="p">(</span><span class="n">obo_version</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element</span> <span class="o">=</span> <span class="n">element</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measured_precision</span> <span class="o">=</span> <span class="n">measured_precision</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noise_level_estimate</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ns</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ns</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\{.*\}&quot;</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\{.*\}&quot;</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_decode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decode_to_numpy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ms_deisotop_warning_printed</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clear self.element to limit RAM usage</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

<div class="viewcode-block" id="Spectrum.__add__">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.Spectrum.__add__">[docs]</a>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_spec</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds two pymzml spectra</span>

<span class="sd">        Arguments:</span>
<span class="sd">            other_spec (Spectrum): spectrum to add to the current spectrum</span>

<span class="sd">        Returns:</span>
<span class="sd">            self (Spectrum): reference to the edited spectrum</span>

<span class="sd">        Example:</span>

<span class="sd">        &gt;&gt;&gt; import pymzml</span>
<span class="sd">        &gt;&gt;&gt; s = pymzml.spec.Spectrum( measuredPrescision = 20e-6 )</span>
<span class="sd">        &gt;&gt;&gt; file_to_read = &quot;../mzML_example_files/xy.mzML.gz&quot;</span>
<span class="sd">        &gt;&gt;&gt; run = pymzml.run.Reader(</span>
<span class="sd">        ...     file_to_read ,</span>
<span class="sd">        ...     MS1_Precision = 5e-6 ,</span>
<span class="sd">        ...     MSn_Precision = 20e-6</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; for spec in run:</span>
<span class="sd">        ...     s += spec</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other_spec</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;reprofiled&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">reprofiled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reprofile_Peaks</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_peaks</span><span class="p">(</span><span class="n">reprofiled</span><span class="p">,</span> <span class="s2">&quot;reprofiled&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">other_spec</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;reprofiled&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">other_spec</span><span class="o">.</span><span class="n">set_peaks</span><span class="p">(</span><span class="n">other_spec</span><span class="o">.</span><span class="n">_reprofile_Peaks</span><span class="p">(),</span> <span class="s2">&quot;reprofiled&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">mz</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">other_spec</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;reprofiled&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;reprofiled&quot;</span><span class="p">][</span><span class="n">mz</span><span class="p">]</span> <span class="o">+=</span> <span class="n">i</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="Spectrum.__sub__">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.Spectrum.__sub__">[docs]</a>
    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_spec</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subtracts two pymzml spectra.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            other_spec (spec.Spectrum): spectrum to subtract from the current</span>
<span class="sd">                spectrum</span>

<span class="sd">        Returns:</span>
<span class="sd">            self (spec.Spectrum): returns self after other_spec was subtracted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other_spec</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;reprofiled&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_peaks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reprofile_Peaks</span><span class="p">(),</span> <span class="s2">&quot;reprofiled&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">other_spec</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;reprofiled&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">other_spec</span><span class="o">.</span><span class="n">set_peaks</span><span class="p">(</span><span class="n">other_spec</span><span class="o">.</span><span class="n">_reprofile_Peaks</span><span class="p">(),</span> <span class="s2">&quot;reprofiled&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">mz</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">other_spec</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;reprofiled&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;reprofiled&quot;</span><span class="p">][</span><span class="n">mz</span><span class="p">]</span> <span class="o">-=</span> <span class="n">i</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_peaks</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;centroided&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_peaks</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;raw&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="Spectrum.__mul__">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.Spectrum.__mul__">[docs]</a>
    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Multiplies each intensity with a float, i.e. scales the spectrum.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            value (int, float): value to multiply the intensities with</span>

<span class="sd">        Returns:</span>
<span class="sd">            self (spec.Spectrum): returns self after intensities were scaled</span>
<span class="sd">                by value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;raw&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_peaks</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">value</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="s2">&quot;raw&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;centroided&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_peaks</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centroided_peaks</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroided_peaks</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">value</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="s2">&quot;centroided&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;reprofiled&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">mz</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;reprofiled&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;reprofiled&quot;</span><span class="p">][</span><span class="n">mz</span><span class="p">]</span> <span class="o">*=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="Spectrum.__truediv__">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.Spectrum.__truediv__">[docs]</a>
    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Divides each intensity by a float, i.e. scales the spectrum.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            value (int, float): value to divide the intensities by</span>

<span class="sd">        Returns:</span>
<span class="sd">            self (spec.Spectrum): returns self after intensities were scaled</span>
<span class="sd">                by value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;reprofiled&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">mz</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;reprofiled&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;reprofiled&quot;</span><span class="p">][</span><span class="n">mz</span><span class="p">]</span> <span class="o">/=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;raw&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;raw&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_peaks</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
                        <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
                        <span class="p">)</span>
                    <span class="p">),</span>
                    <span class="s2">&quot;raw&quot;</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;centroided&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">peaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;centroided&quot;</span><span class="p">]</span>
            <span class="n">scaled_peaks</span> <span class="o">=</span> <span class="n">peaks</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">value</span>
            <span class="n">peaks</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaled_peaks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;centroided&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">peaks</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Integer division is the same as __truediv__ for this class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__truediv__</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns representative string for a spectrum object class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;__main__.Spectrum object with native ID </span><span class="si">{0}</span><span class="s2"> at </span><span class="si">{1}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns representative string for a spectrum object class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;__main__.Spectrum object with native ID </span><span class="si">{0}</span><span class="s2"> at </span><span class="si">{1}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="p">)</span>

<div class="viewcode-block" id="Spectrum.__getitem__">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.Spectrum.__getitem__">[docs]</a>
    <span class="nd">@lru_cache</span><span class="p">()</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">accession</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access spectrum XML information by tag name</span>

<span class="sd">        Args:</span>
<span class="sd">            accession(str): name of the XML tag</span>

<span class="sd">        Returns:</span>
<span class="sd">            value (float or str): value of the XML tag</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#  TODO implement cache???</span>
        <span class="k">if</span> <span class="n">accession</span> <span class="o">==</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span>
            <span class="n">return_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">accession</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;MS:&quot;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">accession</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obo_translator</span><span class="p">[</span><span class="n">accession</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="n">accession</span> <span class="o">=</span> <span class="s2">&quot;---&quot;</span>
            <span class="n">search_string</span> <span class="o">=</span> <span class="s1">&#39;.//*[@accession=&quot;</span><span class="si">{0}</span><span class="s1">&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">accession</span><span class="p">)</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">iterfind</span><span class="p">(</span><span class="n">search_string</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">return_val</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">return_val</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">return_val</span> <span class="o">=</span> <span class="n">elements</span>
        <span class="k">if</span> <span class="n">return_val</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">return_val</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">return_val</span></div>


<div class="viewcode-block" id="Spectrum.get">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.Spectrum.get">[docs]</a>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mimic dicts get function.</span>

<span class="sd">        Args:</span>
<span class="sd">            acc (str): accession or obo tag to return</span>
<span class="sd">            default (None, optional): default value if acc is not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">acc</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">default</span>
        <span class="k">return</span> <span class="n">val</span></div>


    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if MS tag or name can be found in spectrum.</span>

<span class="sd">        Args:</span>
<span class="sd">            value (str): MS tag or OBO name</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">r</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">measured_precision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the measured and internal precision</span>

<span class="sd">        Returns:</span>
<span class="sd">            value (float): measured precision (e.g. 5e-6)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_measured_precision</span>

    <span class="nd">@measured_precision</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">measured_precision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measured_precision</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_precision</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">50000.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">value</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)))</span>
        <span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">t_mz_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a set of integers out of transformed m/z values</span>
<span class="sd">        (including all values in the defined imprecision).</span>
<span class="sd">        This is used to accelerate has_peak function and similar.</span>

<span class="sd">        Returns:</span>
<span class="sd">            t_mz_set (set): set of transformed m/z values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t_mz_set</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_t_mz_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">mz</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;centroided&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_t_mz_set</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span>
                    <span class="nb">range</span><span class="p">(</span>
                        <span class="nb">int</span><span class="p">(</span>
                            <span class="nb">round</span><span class="p">(</span>
                                <span class="p">(</span><span class="n">mz</span> <span class="o">-</span> <span class="p">(</span><span class="n">mz</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">measured_precision</span><span class="p">))</span>
                                <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_precision</span>
                            <span class="p">)</span>
                        <span class="p">),</span>
                        <span class="nb">int</span><span class="p">(</span>
                            <span class="nb">round</span><span class="p">(</span>
                                <span class="p">(</span><span class="n">mz</span> <span class="o">+</span> <span class="p">(</span><span class="n">mz</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">measured_precision</span><span class="p">))</span>
                                <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_precision</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t_mz_set</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">transformed_mz_with_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns transformed m/z value with error</span>

<span class="sd">        Returns:</span>
<span class="sd">            tmz values (dict): Transformed m/z values in dictionary\n</span>
<span class="sd">                {\n</span>
<span class="sd">                m/z_with_error : [(m/z,intensity), ...], ...\n</span>
<span class="sd">                }\n</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transformed_mz_with_error</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_transformed_mz_with_error</span> <span class="o">=</span> <span class="n">ddict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">mz</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;centroided&quot;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">t_mz_with_error</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                    <span class="nb">int</span><span class="p">(</span>
                        <span class="nb">round</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">mz</span> <span class="o">-</span> <span class="p">(</span><span class="n">mz</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">measured_precision</span><span class="p">))</span>
                            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_precision</span>
                        <span class="p">)</span>
                    <span class="p">),</span>
                    <span class="nb">int</span><span class="p">(</span>
                        <span class="nb">round</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">mz</span> <span class="o">+</span> <span class="p">(</span><span class="n">mz</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">measured_precision</span><span class="p">))</span>
                            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_precision</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_transformed_mz_with_error</span><span class="p">[</span><span class="n">t_mz_with_error</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mz</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transformed_mz_with_error</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">transformed_peaks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        m/z value is multiplied by the internal precision.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Transformed peaks (list): Returns a list of peaks (tuples of mz and</span>
<span class="sd">            intensity).</span>
<span class="sd">            Float m/z values are adjusted by the internal precision</span>
<span class="sd">            to integers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transformed_peaks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_transformed_peaks</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_mz</span><span class="p">(</span><span class="n">mz</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">mz</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;centroided&quot;</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transformed_peaks</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">TIC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Property to access the total ion current for this spectrum.</span>

<span class="sd">        Returns:</span>
<span class="sd">            TIC (float): Total Ion Current of the spectrum.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TIC</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_TIC</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                    <span class="s2">&quot;./</span><span class="si">{ns}</span><span class="s2">cvParam[@accession=&#39;MS:1000285&#39;]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span>
                <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
            <span class="p">)</span>  <span class="c1"># put hardcoded MS tags in minimum.py???</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TIC</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ID</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access the native id (last number in the id attribute) of the spectrum.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ID (str): native ID of the spectrum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">regex_patterns</span><span class="o">.</span><span class="n">SPECTRUM_ID_PATTERN</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">id_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access to all entries stored the id attribute of a spectrum.</span>

<span class="sd">        Returns:</span>
<span class="sd">            id_dict (dict): key value pairs for all entries in id attribute of a spectrum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tuples</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">regex_patterns</span><span class="o">.</span><span class="n">SPECTRUM_PATTERN3</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">captures</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">captures</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">captures</span><span class="p">:</span>
                    <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                    <span class="n">tuples</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_id_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">tuples</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_id_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id_dict</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Access the index of the spectrum.</span>

<span class="sd">        Returns:</span>
<span class="sd">            index (int): index of the spectrum</span>

<span class="sd">        Note:</span>
<span class="sd">            This does not necessarily correspond to the native spectrum ID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ms_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Property to access the ms level.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ms_level (int):</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sub_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                <span class="s2">&quot;.//</span><span class="si">{ns}</span><span class="s2">cvParam[@accession=&#39;MS:1000511&#39;]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">sub_element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ms_level</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="n">sub_element</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                <span class="p">)</span>  <span class="c1"># put hardcoded MS tags in minimum.py???</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_level</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scan_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Property to access the retention time and retention time unit.</span>
<span class="sd">        Please note, that we do not assume the retention time unit,</span>
<span class="sd">        if it is not correctly defined in the mzML.</span>
<span class="sd">        It is set to &#39;unicorns&#39; in this case.</span>

<span class="sd">        Returns:</span>
<span class="sd">            scan_time (float):</span>
<span class="sd">            scan_time_unit (str):</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time_unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scan_time_ele</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                <span class="s2">&quot;.//*[@accession=&#39;MS:1000016&#39;]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">scan_time_ele</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time_unit</span> <span class="o">=</span> <span class="n">scan_time_ele</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unitName&quot;</span><span class="p">,</span> <span class="s2">&quot;unicorns&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time_unit</span>

    <span class="c1"># @property</span>
<div class="viewcode-block" id="Spectrum.scan_time_in_minutes">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.Spectrum.scan_time_in_minutes">[docs]</a>
    <span class="k">def</span> <span class="nf">scan_time_in_minutes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Property to access the retention time in minutes.</span>
<span class="sd">        If the retention time unit is defined within the mzML,</span>
<span class="sd">        the retention time is converted into minutes and returned</span>
<span class="sd">        without the unit.</span>

<span class="sd">        Returns:</span>
<span class="sd">            scan_time (float):</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time_in_minutes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time</span><span class="p">,</span> <span class="n">time_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_time</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time_unit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;millisecond&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time_in_minutes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time</span> <span class="o">/</span> <span class="mf">1000.0</span> <span class="o">/</span> <span class="mf">60.0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time_unit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;second&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time_in_minutes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time</span> <span class="o">/</span> <span class="mf">60.0</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time_unit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;minute&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time_in_minutes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time_unit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;hour&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time_in_minutes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time</span> <span class="o">*</span> <span class="mf">60.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Time unit &#39;</span><span class="si">{0}</span><span class="s2">&#39; unknown&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scan_time_unit</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_time_in_minutes</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">selected_precursors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Property to access the selected precursors of a MS2 spectrum. Returns</span>
<span class="sd">        a list of dicts containing the precursors mz and, if available intensity</span>
<span class="sd">        and charge for each precursor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            selected_precursors (list):</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_precursors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">selected_precursor_mzs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span>
                <span class="s2">&quot;.//*[@accession=&#39;MS:1000744&#39;]&quot;</span>
            <span class="p">)</span>
            <span class="n">selected_precursor_is</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span>
                <span class="s2">&quot;.//*[@accession=&#39;MS:1000042&#39;]&quot;</span>
            <span class="p">)</span>
            <span class="n">selected_precursor_cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span>
                <span class="s2">&quot;.//*[@accession=&#39;MS:1000041&#39;]&quot;</span>
            <span class="p">)</span>
            <span class="n">precursors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span>
                <span class="s2">&quot;./</span><span class="si">{ns}</span><span class="s2">precursorList/</span><span class="si">{ns}</span><span class="s2">precursor&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">mz_values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">i_values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">charges</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">selected_precursor_mzs</span><span class="p">:</span>
                <span class="n">mz</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                <span class="n">mz_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mz</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">selected_precursor_is</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                <span class="n">i_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">selected_precursor_cs</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                <span class="n">charges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">prec</span> <span class="ow">in</span> <span class="n">precursors</span><span class="p">:</span>
                <span class="n">spec_ref</span> <span class="o">=</span> <span class="n">prec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;spectrumRef&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">spec_ref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">regex_patterns</span><span class="o">.</span><span class="n">SPECTRUM_ID_PATTERN</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">spec_ref</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="c1"># ids.append()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selected_precursors</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">mz</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mz_values</span><span class="p">):</span>
                <span class="n">dict_2_save</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;mz&quot;</span><span class="p">:</span> <span class="n">mz</span><span class="p">}</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">list_of_values</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="n">i_values</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;charge&quot;</span><span class="p">,</span> <span class="n">charges</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;precursor id&quot;</span><span class="p">,</span> <span class="n">ids</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;element&quot;</span><span class="p">,</span> <span class="n">precursors</span><span class="p">),</span>
                <span class="p">]:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">dict_2_save</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">list_of_values</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_selected_precursors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_2_save</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_precursors</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">precursors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List the precursor information of this spectrum, if available.</span>
<span class="sd">        Returns:</span>
<span class="sd">            precursor(list): list of precursor ids for this spectrum.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deprecation_warning</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precursors</span><span class="p">:</span>
            <span class="n">precursors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span>
                <span class="s2">&quot;./</span><span class="si">{ns}</span><span class="s2">precursorList/</span><span class="si">{ns}</span><span class="s2">precursor&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_precursors</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">prec</span> <span class="ow">in</span> <span class="n">precursors</span><span class="p">:</span>
                <span class="n">spec_ref</span> <span class="o">=</span> <span class="n">prec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;spectrumRef&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_precursors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">regex_patterns</span><span class="o">.</span><span class="n">SPECTRUM_ID_PATTERN</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">spec_ref</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precursors</span>

    <span class="k">def</span> <span class="nf">remove_precursor_peak</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">peaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;centroided&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">precursor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_precursors</span><span class="p">:</span>
            <span class="n">mz</span> <span class="o">=</span> <span class="n">precursor</span><span class="p">[</span><span class="s2">&quot;mz&quot;</span><span class="p">]</span>
            <span class="n">hp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_peak</span><span class="p">(</span><span class="n">mz</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">hp</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">hp</span><span class="p">:</span>
                    <span class="n">peaks</span> <span class="o">=</span> <span class="n">peaks</span><span class="p">[(</span><span class="n">peaks</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_peaks</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="s2">&quot;centroided&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_peaks</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="s2">&quot;raw&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">peaks</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the list of m/z values. If the m/z values are encoded, the</span>
<span class="sd">        function :func:`~spec.MS_Spectrum._decode` is used to decode the encoded data.</span>
<span class="sd">        The mz property can also be set, e.g. for theoretical data.</span>
<span class="sd">        However, it is recommended to use the peaks property to set mz and</span>
<span class="sd">        intensity tuples at same time.</span>

<span class="sd">        Returns:</span>
<span class="sd">            mz (list): list of m/z values of spectrum.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mz</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_encoding_parameters</span><span class="p">(</span><span class="s2">&quot;m/z array&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decode</span><span class="p">(</span><span class="o">*</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mz</span>

    <span class="nd">@mz</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">mz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz_list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="n">mz_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mz_list</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">mz_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mz</span> <span class="o">=</span> <span class="n">mz_list</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">i</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the list of the intensity values.</span>
<span class="sd">        If the intensity values are encoded, the function :func:`~spec.MS_Spectrum._decode`</span>
<span class="sd">        is used to decode the encoded data.\n</span>
<span class="sd">        The i property can also be set, e.g. for theoretical data. However,</span>
<span class="sd">        it is recommended to use the peaks property to set mz and intensity</span>
<span class="sd">        tuples at same time.</span>

<span class="sd">        Returns</span>
<span class="sd">            i (list): list of intensity values from the analyzed spectrum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_encoding_parameters</span><span class="p">(</span><span class="s2">&quot;intensity array&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decode</span><span class="p">(</span><span class="o">*</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_i</span>

    <span class="nd">@i</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">i</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intensity_list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_i</span> <span class="o">=</span> <span class="n">intensity_list</span>

<div class="viewcode-block" id="Spectrum.peaks">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.Spectrum.peaks">[docs]</a>
    <span class="k">def</span> <span class="nf">peaks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">peak_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decode and return a list of mz/i tuples.</span>

<span class="sd">        Args:</span>
<span class="sd">            peak_type(str): currently supported types are:</span>
<span class="sd">                raw, centroided and reprofiled</span>

<span class="sd">        Returns:</span>
<span class="sd">            peaks (list or ndarray): list or numpy array of mz/i tuples or arrays</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="n">peak_type</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;raw&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mz_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_encoding_parameters</span><span class="p">(</span><span class="s2">&quot;m/z array&quot;</span><span class="p">)</span>
                <span class="n">i_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_encoding_parameters</span><span class="p">(</span><span class="s2">&quot;intensity array&quot;</span><span class="p">)</span>
                <span class="n">mz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decode</span><span class="p">(</span><span class="o">*</span><span class="n">mz_params</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decode</span><span class="p">(</span><span class="o">*</span><span class="n">i_params</span><span class="p">)</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">mz</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="n">peak_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span>
            <span class="k">if</span> <span class="n">peak_type</span> <span class="o">==</span> <span class="s2">&quot;raw&quot;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">peak_type</span> <span class="o">==</span> <span class="s2">&quot;centroided&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;centroided&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_centroid_peaks</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">peak_type</span> <span class="o">==</span> <span class="s2">&quot;reprofiled&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;reprofiled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reprofile_Peaks</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">peak_type</span> <span class="o">==</span> <span class="s2">&quot;deconvoluted&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;deconvoluted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deconvolute_peaks</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="n">peak_type</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">peaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="n">peak_type</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">peaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="n">peak_type</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">peak_type</span> <span class="o">==</span> <span class="s2">&quot;reprofiled&quot;</span><span class="p">:</span>
            <span class="n">peaks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="n">peak_type</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">peaks</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">peaks</span></div>


    <span class="nd">@lru_cache</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">get_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr_name</span><span class="p">):</span>
        <span class="n">array_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_encoding_parameters</span><span class="p">(</span><span class="n">arr_name</span><span class="p">)</span>
        <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decode</span><span class="p">(</span><span class="o">*</span><span class="n">array_params</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">array</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_arrays_in_spec</span><span class="p">(</span><span class="n">not_found_array</span><span class="o">=</span><span class="n">arr_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">array</span>

    <span class="k">def</span> <span class="nf">get_tims_tof_ion_mobility</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">array_name</span><span class="o">=</span><span class="s2">&quot;mean inverse reduced ion mobility array&quot;</span>
    <span class="p">):</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="n">array_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_arrays_in_spec</span><span class="p">(</span><span class="n">not_found_array</span><span class="o">=</span><span class="n">array_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">arr</span>

    <span class="k">def</span> <span class="nf">get_all_arrays_in_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">not_found_array</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">b_data_string</span> <span class="o">=</span> <span class="s2">&quot;./</span><span class="si">{ns}</span><span class="s2">binaryDataArrayList/</span><span class="si">{ns}</span><span class="s2">binaryDataArray/</span><span class="si">{ns}</span><span class="s2">cvParam[@unitCvRef=&#39;MS&#39;]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span>
        <span class="p">)</span>
        <span class="n">b_data_arrays</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">b_data_string</span><span class="p">)</span>
        <span class="n">array_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">arr</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">b_data_arrays</span><span class="p">]</span>
        <span class="n">formatted_array_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">array_names</span><span class="p">:</span>
            <span class="n">formatted_array_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">- </span><span class="si">{name}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">not_found_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Requested array (</span><span class="si">{not_found_array}</span><span class="s2">) not found.</span><span class="se">\n</span><span class="s2">Available arrays are:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">not_found_array</span><span class="o">=</span><span class="n">not_found_array</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formatted_array_names</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">array_names</span>

    <span class="k">def</span> <span class="nf">_deconvolute_peaks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">DECON_DEP</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">peaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;centroided&quot;</span><span class="p">)</span>
            <span class="c1"># pack peak matrix into expected structure</span>
            <span class="n">peaks</span> <span class="o">=</span> <span class="p">[</span><span class="n">simple_peak</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.01</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">]</span>
            <span class="n">decon_result</span> <span class="o">=</span> <span class="n">deconvolute_peaks</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">dpeaks</span> <span class="o">=</span> <span class="n">decon_result</span><span class="o">.</span><span class="n">peak_set</span>
            <span class="c1"># pack deconvoluted peak list into matrix structure</span>
            <span class="n">dpeaks_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">dpeaks</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dpeaks</span><span class="p">):</span>
                <span class="n">dpeaks_mat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">neutral_mass</span><span class="p">,</span> <span class="n">dp</span><span class="o">.</span><span class="n">intensity</span><span class="p">,</span> <span class="n">dp</span><span class="o">.</span><span class="n">charge</span>
            <span class="k">return</span> <span class="n">dpeaks_mat</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ms_deisotop_warning_printed</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;ms_deisotope is missing, please install using pip install ms_deisotope&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ms_deisotop_warning_printed</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="Spectrum.set_peaks">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.Spectrum.set_peaks">[docs]</a>
    <span class="k">def</span> <span class="nf">set_peaks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">peaks</span><span class="p">,</span> <span class="n">peak_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign a custom peak array of type peak_type</span>

<span class="sd">        Args:</span>
<span class="sd">            peaks(list or ndarray): list or array of mz/i values</span>
<span class="sd">            peak_type(str): Either raw, centroided or reprofiled</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">peak_type</span> <span class="o">=</span> <span class="n">peak_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="c1"># reset after changing peaks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transformed_mass_with_error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transformed_mz_with_error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">peak_type</span> <span class="o">==</span> <span class="s2">&quot;raw&quot;</span><span class="p">:</span>
            <span class="c1"># if not isinstance(peaks, np.ndarray):</span>
            <span class="c1">#     peaks = np.array(peaks)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;raw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">peaks</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

        <span class="k">elif</span> <span class="n">peak_type</span> <span class="o">==</span> <span class="s2">&quot;centroided&quot;</span><span class="p">:</span>
            <span class="c1"># if not isinstance(peaks, np.ndarray):</span>
            <span class="c1">#     peaks = np.array(peaks)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;centroided&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">peaks</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

        <span class="k">elif</span> <span class="n">peak_type</span> <span class="o">==</span> <span class="s2">&quot;reprofiled&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;reprofiled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">peaks</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;reprofiled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">peak_type</span> <span class="o">==</span> <span class="s2">&quot;deconvoluted&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;deconvoluted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">peaks</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Peak type is not suppported</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s1">&#39;Choose either &quot;raw&quot;, &quot;centroided&quot; or &quot;reprofiled&quot;&#39;</span>
            <span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_centroid_peaks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform a Gauss fit to centroid the peaks for the property</span>
<span class="sd">        centroided_peaks.</span>

<span class="sd">        Returns:</span>
<span class="sd">            centroided_peaks (list): list of centroided m/z, i tuples</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">profile_ot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obo_translator</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;profile spectrum&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">profile_ot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">profile_ot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obo_translator</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;profile mass spectrum&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">acc</span> <span class="o">=</span> <span class="n">profile_ot</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
            <span class="n">is_profile</span> <span class="o">=</span> <span class="p">(</span>
                <span class="kc">True</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                    <span class="s2">&quot;.//*[@accession=&#39;</span><span class="si">{acc}</span><span class="s2">&#39;]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">,</span> <span class="n">acc</span><span class="o">=</span><span class="n">acc</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># user creadted spectrum objects without xml and calling instance cant determine if they are reprofiled or not</span>
            <span class="n">is_profile</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">is_profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">reprofiled</span><span class="p">:</span>  <span class="c1"># check if spec is a profile spec</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;reprofiled&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">i_array</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">mz</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;reprofiled&quot;</span><span class="p">)]</span>
                <span class="n">mz_array</span> <span class="o">=</span> <span class="p">[</span><span class="n">mz</span> <span class="k">for</span> <span class="n">mz</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;reprofiled&quot;</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span>
                <span class="n">mz_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mz</span>
            <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">i_array</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">i_array</span><span class="p">[</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">i_array</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">x1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mz_array</span><span class="p">[</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">y1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i_array</span><span class="p">[</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">x2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mz_array</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
                    <span class="n">y2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i_array</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
                    <span class="n">x3</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mz_array</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">y3</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i_array</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">x3</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="ow">or</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">&lt;</span> <span class="n">x3</span> <span class="o">-</span> <span class="n">x2</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">y3</span> <span class="o">==</span> <span class="n">y1</span><span class="p">:</span>
                        <span class="n">y3</span> <span class="o">+=</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">y1</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">double_log</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y2</span> <span class="o">/</span> <span class="n">y1</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y3</span> <span class="o">/</span> <span class="n">y1</span><span class="p">)</span>
                        <span class="n">mue</span> <span class="o">=</span> <span class="p">(</span><span class="n">double_log</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x3</span> <span class="o">*</span> <span class="n">x3</span><span class="p">)</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                            <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">double_log</span> <span class="o">*</span> <span class="p">(</span><span class="n">x3</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">c_squarred</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">x2</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">mue</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">mue</span>
                        <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y1</span> <span class="o">/</span> <span class="n">y2</span><span class="p">))</span>
                        <span class="n">A</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">mue</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">mue</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">c_squarred</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mue</span><span class="p">,</span> <span class="n">A</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">tmp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_reprofile_Peaks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs reprofiling for property reprofiled_peaks.</span>

<span class="sd">        Returns:</span>
<span class="sd">            reprofiled_peaks (list): list of reprofiled m/z, i tuples</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">ddict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">mz</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;centroided&quot;</span><span class="p">):</span>
            <span class="c1"># Let the measured precision be 2 sigma of the signal width</span>
            <span class="c1"># When using normal distribution</span>
            <span class="c1"># FWHM = 2 sqt(2 * ln(2)) sigma = 2.3548 sigma</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">mz</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">measured_precision</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># in before 2</span>
            <span class="n">s2</span> <span class="o">=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">s</span>
            <span class="n">floor</span> <span class="o">=</span> <span class="n">mz</span> <span class="o">-</span> <span class="mf">5.0</span> <span class="o">*</span> <span class="n">s</span>  <span class="c1"># Gauss curve +- 3 sigma</span>
            <span class="n">ceil</span> <span class="o">=</span> <span class="n">mz</span> <span class="o">+</span> <span class="mf">5.0</span> <span class="o">*</span> <span class="n">s</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_precision</span> <span class="o">/</span> <span class="mi">4</span>
            <span class="c1"># more spacing, i.e. less points describing the gauss curve</span>
            <span class="c1"># -&gt; faster adding</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">floor</span> <span class="o">*</span> <span class="n">ip</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ceil</span> <span class="o">*</span> <span class="n">ip</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">_</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">((</span><span class="n">mz</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">mz</span> <span class="o">-</span> <span class="n">a</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">s2</span><span class="p">))</span>
                    <span class="n">tmp</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">+=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reprofiled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_peaks</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;centroided&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tmp</span>

    <span class="k">def</span> <span class="nf">_mz_2_mass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz</span><span class="p">,</span> <span class="n">charge</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the uncharged mass for a given mz value</span>

<span class="sd">        Arguments:</span>
<span class="sd">            mz (float)  : m/z value</span>
<span class="sd">            charge(int) : charge</span>

<span class="sd">        Returns:</span>
<span class="sd">            mass (float): Returns mass of a given m/z value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">mz</span> <span class="o">-</span> <span class="n">PROTON</span><span class="p">)</span> <span class="o">*</span> <span class="n">charge</span>

    <span class="k">def</span> <span class="nf">_set_params_from_reference_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_element</span><span class="p">):</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{ns}</span><span class="s2">referenceableParamGroupRef&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ref&quot;</span><span class="p">)</span>
        <span class="n">ele</span> <span class="o">=</span> <span class="n">ref_element</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.//*[@id=&#39;</span><span class="si">{ref}</span><span class="s2">&#39;]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span> <span class="n">ns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ele</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ref</span> <span class="o">==</span> <span class="n">ele</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">ele</span><span class="o">.</span><span class="n">iter</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ele</span><span class="p">)</span>
                <span class="n">acc</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;accession&quot;</span><span class="p">)</span>

    <span class="c1"># Public functions</span>

<div class="viewcode-block" id="Spectrum.reduce">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.Spectrum.reduce">[docs]</a>
    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">peak_type</span><span class="o">=</span><span class="s2">&quot;raw&quot;</span><span class="p">,</span> <span class="n">mz_range</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove all m/z values outside the given range.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            mz_range (tuple): tuple of min, max values</span>

<span class="sd">        Returns:</span>
<span class="sd">            peaks (list): list of mz, i tuples in the given range.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="n">peak_type</span><span class="p">)</span>
        <span class="n">peaks</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">mz_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">mz_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_peaks</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">peak_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">peaks</span></div>


<div class="viewcode-block" id="Spectrum.remove_noise">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.Spectrum.remove_noise">[docs]</a>
    <span class="k">def</span> <span class="nf">remove_noise</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">,</span> <span class="n">noise_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">signal_to_noise_threshold</span><span class="o">=</span><span class="mf">1.0</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to remove noise from peaks, centroided peaks and reprofiled</span>
<span class="sd">        peaks.</span>

<span class="sd">        Keyword arguments:</span>
<span class="sd">                mode (str): define mode for removing noise. Default = &quot;median&quot;</span>
<span class="sd">                (other modes: &quot;mean&quot;, &quot;mad&quot;)</span>
<span class="sd">            noise_level (float): noise threshold</span>
<span class="sd">            signal_to_noise_threshold (float): S/N threshold for a peak to be accepted</span>

<span class="sd">        Returns:</span>
<span class="sd">            reprofiled peaks (list): Returns a list with tuples of</span>
<span class="sd">            m/z-intensity pairs above the noise threshold</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Thanks to JD Hogan for pointing it out!</span>
        <span class="n">callPeaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">)</span>
        <span class="c1"># callcentPeaks = self.peaks(&quot;centroided&quot;)</span>
        <span class="k">if</span> <span class="n">noise_level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">noise_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimated_noise_level</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;centroided&quot;</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;centroided&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;centroided&quot;</span><span class="p">)[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;centroided&quot;</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">noise_level</span>
                <span class="o">&gt;=</span> <span class="n">signal_to_noise_threshold</span>
            <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;raw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">)[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">noise_level</span> <span class="o">&gt;=</span> <span class="n">signal_to_noise_threshold</span>
            <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_peak_dict</span><span class="p">[</span><span class="s2">&quot;reprofiled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="Spectrum.estimated_noise_level">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.Spectrum.estimated_noise_level">[docs]</a>
    <span class="k">def</span> <span class="nf">estimated_noise_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates noise threshold for function remove_noise.</span>

<span class="sd">        Different modes are available. Default is &#39;median&#39;</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            mode (str): define mode for removing noise. Default = &quot;median&quot;</span>
<span class="sd">                (other modes: &quot;mean&quot;, &quot;mad&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            noise_level (float): estimate noise threshold</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;centroided&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># or is None?</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">noise_level_estimate</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise_level_estimate</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;median&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">noise_level_estimate</span><span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;centroided&quot;</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;mad&quot;</span><span class="p">:</span>
                <span class="n">median</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimated_noise_level</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">noise_level_estimate</span><span class="p">[</span><span class="s2">&quot;mad&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span>
                    <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;centroided&quot;</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">median</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">noise_level_estimate</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;centroided&quot;</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;centroided&quot;</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;Do not understand noise level estimation method call with given mode: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">mode</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">return_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise_level_estimate</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">return_value</span></div>


<div class="viewcode-block" id="Spectrum.highest_peaks">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.Spectrum.highest_peaks">[docs]</a>
    <span class="k">def</span> <span class="nf">highest_peaks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to retrieve the n-highest centroided peaks of the spectrum.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            n (int): number of highest peaks to return.</span>

<span class="sd">        Returns:</span>
<span class="sd">            centroided peaks (list): list mz, i tupls with n-highest</span>

<span class="sd">        Example:</span>

<span class="sd">        &gt;&gt;&gt; run = pymzml.run.Reader(</span>
<span class="sd">        ...     &quot;tests/data/example.mzML.gz&quot;,</span>
<span class="sd">        ...      MS_precisions =  {</span>
<span class="sd">        ...         1 : 5e-6,</span>
<span class="sd">        ...         2 : 20e-6</span>
<span class="sd">        ...     }</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; for spectrum in run:</span>
<span class="sd">        ...     if spectrum.ms_level == 2:</span>
<span class="sd">        ...         if spectrum.ID == 1770:</span>
<span class="sd">        ...             for mz,i in spectrum.highest_peaks(5):</span>
<span class="sd">        ...                print(mz, i)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_centroided_peaks_sorted_by_i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_centroided_peaks_sorted_by_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;centroided&quot;</span><span class="p">)[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;centroided&quot;</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
            <span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_centroided_peaks_sorted_by_i</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">:]</span></div>


<div class="viewcode-block" id="Spectrum.ppm2abs">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.Spectrum.ppm2abs">[docs]</a>
    <span class="k">def</span> <span class="nf">ppm2abs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">ppm_value</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the value plus (or minus, dependent on direction) the</span>
<span class="sd">        error (measured precision ) for this value.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            value (float)   : m/z value</span>
<span class="sd">            ppm_value (int)  : ppm value</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            direction (int) : plus or minus the considered m/z value.</span>
<span class="sd">                The argument *direction* should be 1 or -1</span>
<span class="sd">            factor (int)    : multiplication factor for the imprecision.</span>
<span class="sd">                The argument *factor* should be bigger than 0</span>

<span class="sd">        Returns:</span>
<span class="sd">            imprecision (float): imprecision for the given value</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="p">(</span><span class="n">value</span> <span class="o">*</span> <span class="p">(</span><span class="n">ppm_value</span> <span class="o">*</span> <span class="n">factor</span><span class="p">))</span> <span class="o">*</span> <span class="n">direction</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="Spectrum.extreme_values">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.Spectrum.extreme_values">[docs]</a>
    <span class="k">def</span> <span class="nf">extreme_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find extreme values, minimal and maximum m/z and intensity</span>

<span class="sd">        Arguments:</span>
<span class="sd">            key (str)       : m/z : &quot;mz&quot; or  intensity : &quot;i&quot;</span>

<span class="sd">        Returns:</span>
<span class="sd">            extrema (tuple) : tuple of minimal and maximum m/z or intensity</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">available_extreme_values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mz&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available_extreme_values</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Do not understand extreme request: &#39;</span><span class="si">{0}</span><span class="s2">&#39;; available values are: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">key</span><span class="p">,</span> <span class="n">available_extreme_values</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">exit</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extreme_values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extreme_values</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;mz&quot;</span><span class="p">:</span>
                <span class="n">all_mz_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_extreme_values</span><span class="p">[</span><span class="s2">&quot;mz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">all_mz_values</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">all_mz_values</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_extreme_values</span><span class="p">[</span><span class="s2">&quot;mz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">all_i_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_extreme_values</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># emtpy spectrum</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extreme_values</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extreme_values</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>


<div class="viewcode-block" id="Spectrum.has_peak">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.Spectrum.has_peak">[docs]</a>
    <span class="k">def</span> <span class="nf">has_peak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz2find</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if a Spectrum has a certain peak.</span>
<span class="sd">        Requires a m/z value as input and returns a list of peaks if the m/z</span>
<span class="sd">        value is found in the spectrum, otherwise ``[]`` is returned.</span>
<span class="sd">        Every peak is a tuple of m/z and intensity.</span>

<span class="sd">        Note:</span>
<span class="sd">            Multiple peaks may be found, depending on the defined precisions</span>

<span class="sd">        Arguments:</span>
<span class="sd">            mz2find (float): m/z value which should be found</span>

<span class="sd">        Returns:</span>
<span class="sd">            peaks (list): list of m/z, i tuples</span>

<span class="sd">        Example:</span>

<span class="sd">        &gt;&gt;&gt; import pymzml</span>
<span class="sd">        &gt;&gt;&gt; example_file = &#39;tests/data/example.mzML&#39;</span>
<span class="sd">        &gt;&gt;&gt; run = pymzml.run.Reader(</span>
<span class="sd">        ...     example_file,</span>
<span class="sd">        ...     MS_precisions =  {</span>
<span class="sd">        ...         1 : 5e-6,</span>
<span class="sd">        ...         2 : 20e-6</span>
<span class="sd">        ...     }</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; for spectrum in run:</span>
<span class="sd">        ...     if spectrum.ms_level == 2:</span>
<span class="sd">        ...             peak_to_find = spectrum.has_peak(1016.5404)</span>
<span class="sd">        ...             print(peak_to_find)</span>
<span class="sd">        [(1016.5404, 19141.735187697403)]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_mz</span><span class="p">(</span><span class="n">mz2find</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformed_mz_with_error</span><span class="p">[</span><span class="n">value</span><span class="p">]</span></div>


<div class="viewcode-block" id="Spectrum.has_overlapping_peak">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.Spectrum.has_overlapping_peak">[docs]</a>
    <span class="k">def</span> <span class="nf">has_overlapping_peak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if a spectrum has more than one peak for a given m/z value</span>
<span class="sd">        and within the measured precision</span>

<span class="sd">        Arguments:</span>
<span class="sd">            mz (float): m/z value which should be checked</span>

<span class="sd">        Returns:</span>
<span class="sd">            Boolean (bool): Returns ``True`` if a nearby peak is detected,</span>
<span class="sd">            otherwise ``False``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">minus_or_plus</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppm2abs</span><span class="p">(</span><span class="n">mz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measured_precision</span><span class="p">,</span> <span class="n">minus_or_plus</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_peak</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ppm2abs</span><span class="p">(</span><span class="n">mz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measured_precision</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">temp</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Spectrum.similarity_to">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.Spectrum.similarity_to">[docs]</a>
    <span class="k">def</span> <span class="nf">similarity_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec2</span><span class="p">,</span> <span class="n">round_precision</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compares two spectra and returns cosine</span>

<span class="sd">        Arguments:</span>
<span class="sd">            spec2 (Spectrum): another pymzml spectrum that is compared to the</span>
<span class="sd">                current spectrum.</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            round_precision (int): precision mzs are rounded to, i.e. round( mz,</span>
<span class="sd">                round_precision )</span>

<span class="sd">        Returns:</span>
<span class="sd">            cosine (float): value between 0 and 1, i.e. the cosine between the</span>
<span class="sd">                two spectra.</span>

<span class="sd">        Note:</span>
<span class="sd">            Spectra data is transformed into an n-dimensional vector,</span>
<span class="sd">            where m/z values are binned in bins of 10 m/z and the intensities</span>
<span class="sd">            are added up. Then the cosine is calculated between those two</span>
<span class="sd">            vectors. The more similar the specs are, the closer the value is</span>
<span class="sd">            to 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec2</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">),</span> <span class="s2">&quot;Spectrum 2 is not a pymzML spectrum&quot;</span>

        <span class="n">vector1</span> <span class="o">=</span> <span class="n">ddict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">vector2</span> <span class="o">=</span> <span class="n">ddict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">mzs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">mz</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">):</span>
            <span class="n">vector1</span><span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">mz</span><span class="p">,</span> <span class="n">round_precision</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">i</span>
            <span class="n">mzs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mz</span><span class="p">,</span> <span class="n">round_precision</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">mz</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">spec2</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">):</span>
            <span class="n">vector2</span><span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">mz</span><span class="p">,</span> <span class="n">round_precision</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">i</span>
            <span class="n">mzs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mz</span><span class="p">,</span> <span class="n">round_precision</span><span class="p">))</span>

        <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">n_v1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">n_v2</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">mz</span> <span class="ow">in</span> <span class="n">mzs</span><span class="p">:</span>
            <span class="n">int1</span> <span class="o">=</span> <span class="n">vector1</span><span class="p">[</span><span class="n">mz</span><span class="p">]</span>
            <span class="n">int2</span> <span class="o">=</span> <span class="n">vector2</span><span class="p">[</span><span class="n">mz</span><span class="p">]</span>
            <span class="n">z</span> <span class="o">+=</span> <span class="n">int1</span> <span class="o">*</span> <span class="n">int2</span>
            <span class="n">n_v1</span> <span class="o">+=</span> <span class="n">int1</span> <span class="o">*</span> <span class="n">int1</span>
            <span class="n">n_v2</span> <span class="o">+=</span> <span class="n">int2</span> <span class="o">*</span> <span class="n">int2</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cosine</span> <span class="o">=</span> <span class="n">z</span> <span class="o">/</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n_v1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n_v2</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">cosine</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="n">cosine</span></div>


<div class="viewcode-block" id="Spectrum.transform_mz">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.Spectrum.transform_mz">[docs]</a>
    <span class="k">def</span> <span class="nf">transform_mz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        pymzml uses an internal precision for different tasks. This precision</span>
<span class="sd">        depends on the measured precision and is calculated when</span>
<span class="sd">        :py:attr:`spec.Spectrum.measured_precision` is invoked. transform_mz</span>
<span class="sd">        can be used to transform m/z values into the internal standard.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            value (float): m/z value</span>

<span class="sd">        Returns:</span>
<span class="sd">            transformed value (float): to internal standard transformed mz</span>
<span class="sd">            value this value can be used to probe internal dictionaries,</span>
<span class="sd">            lists or sets, e.g. :func:`pymzml.spec.Spectrum.t_mz_set`</span>

<span class="sd">        Example:</span>

<span class="sd">            &gt;&gt;&gt; import pymzml</span>
<span class="sd">            &gt;&gt;&gt; run = pymzml.run.Reader(</span>
<span class="sd">            ...     &quot;test.mzML.gz&quot; ,</span>
<span class="sd">            ...     MS_precisions =  {</span>
<span class="sd">            ...         1 : 5e-6,</span>
<span class="sd">            ...         2 : 20e-6</span>
<span class="sd">            ...     }</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; for spectrum in run:</span>
<span class="sd">            ...     if spectrum.ms_level == 2:</span>
<span class="sd">            ...         peak_to_find = spectrum.has_deconvoluted_peak(</span>
<span class="sd">            ...             1044.5804</span>
<span class="sd">            ...         )</span>
<span class="sd">            ...         print(peak_to_find)</span>
<span class="sd">            [(1044.5596, 3809.4356300564586)]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">value</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_precision</span><span class="p">))</span></div>


    <span class="k">def</span> <span class="nf">deprecation_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_name</span><span class="p">):</span>
        <span class="n">deprecation_lookup</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;similarityTo&quot;</span><span class="p">:</span> <span class="s2">&quot;similarity_to&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hasPeak&quot;</span><span class="p">:</span> <span class="s2">&quot;has_peak&quot;</span><span class="p">,</span>
            <span class="s2">&quot;extremeValues&quot;</span><span class="p">:</span> <span class="s2">&quot;extreme_values&quot;</span><span class="p">,</span>
            <span class="s2">&quot;transformMZ&quot;</span><span class="p">:</span> <span class="s2">&quot;transform_mz&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hasOverlappingPeak&quot;</span><span class="p">:</span> <span class="s2">&quot;has_overlapping_peak&quot;</span><span class="p">,</span>
            <span class="s2">&quot;highestPeaks&quot;</span><span class="p">:</span> <span class="s2">&quot;highest_peaks&quot;</span><span class="p">,</span>
            <span class="s2">&quot;estimatedNoiseLevel&quot;</span><span class="p">:</span> <span class="s2">&quot;estimated_noise_level&quot;</span><span class="p">,</span>
            <span class="s2">&quot;removeNoise&quot;</span><span class="p">:</span> <span class="s2">&quot;remove_noise&quot;</span><span class="p">,</span>
            <span class="s2">&quot;newPlot&quot;</span><span class="p">:</span> <span class="s2">&quot;new_plot&quot;</span><span class="p">,</span>
            <span class="s2">&quot;centroidedPeaks&quot;</span><span class="p">:</span> <span class="s2">&quot;peaks&quot;</span><span class="p">,</span>
            <span class="s2">&quot;precursors&quot;</span><span class="p">:</span> <span class="s2">&quot;selected_precursors&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Function: &quot;{0}&quot; deprecated since version 1.0.0, please use new function: &quot;{1}&quot;</span>
<span class="sd">            &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">function_name</span><span class="p">,</span> <span class="n">deprecation_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">function_name</span><span class="p">,</span> <span class="s2">&quot;not_defined_yet&quot;</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="ne">DeprecationWarning</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">similarityTo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec2</span><span class="p">,</span> <span class="n">round_precision</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deprecation_warning</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarity_to</span><span class="p">(</span><span class="n">spec2</span><span class="p">,</span> <span class="n">round_precision</span><span class="o">=</span><span class="n">round_precision</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">hasPeak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deprecation_warning</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_peak</span><span class="p">(</span><span class="n">mz</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">extremeValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deprecation_warning</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extreme_values</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">transformMZ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deprecation_warning</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_mz</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">hasOverlappingPeak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mz</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deprecation_warning</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_overlapping_peak</span><span class="p">(</span><span class="n">mz</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">highestPeaks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deprecation_warning</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">highest_peaks</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">estimatedNoiseLevel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deprecation_warning</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimated_noise_level</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">removeNoise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">,</span> <span class="n">noiseLevel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deprecation_warning</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_noise</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">noise_level</span><span class="o">=</span><span class="n">noiseLevel</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">centroidedPeaks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># self.deprecation_warning( sys._getframe().f_code.co_name )</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">peaks</span><span class="p">(</span><span class="s2">&quot;centroided&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Chromatogram">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.Chromatogram">[docs]</a>
<span class="k">class</span> <span class="nc">Chromatogram</span><span class="p">(</span><span class="n">MS_Spectrum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for Chromatogram access and handling.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">measured_precision</span><span class="o">=</span><span class="mf">5e-6</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">obo_version</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Arguments:</span>
<span class="sd">            element (xml.etree.ElementTree.Element): spectrum as xml Element</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            measured_precision (float): in ppm, i.e. 5e-6 equals to 5 ppm.</span>
<span class="sd">            param (dict): parameter mapping for this spectrum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_measured_precision</span> <span class="o">=</span> <span class="n">measured_precision</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element</span> <span class="o">=</span> <span class="n">element</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noise_level_estimate</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Property variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ms_level</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_i</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t_mass_set</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_peaks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t_mz_set</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_centroided_peaks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reprofiled_peaks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deconvoluted_peaks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extreme_values</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_centroided_peaks_sorted_by_i</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transformed_mz_with_error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transformed_mass_with_error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_precursors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obo_translator</span> <span class="o">=</span> <span class="n">OboTranslator</span><span class="o">.</span><span class="n">from_cache</span><span class="p">(</span><span class="n">obo_version</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">:</span>
            <span class="c1"># self._read_accessions()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ns</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\{.*\}&quot;</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\{.*\}&quot;</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="p">)</span>
            <span class="c1"># self._ns_paths            = {</span>
            <span class="c1">#     &#39;mz&#39;      : &quot;{ns}binaryDataArrayList/&quot; \</span>
            <span class="c1">#                 &quot;{ns}binaryDataArray/&quot; \</span>
            <span class="c1">#                 &quot;{ns}cvParam[@accession=&#39;{Acc}&#39;]/..&quot;.format(</span>
            <span class="c1">#                     ns=self.ns,</span>
            <span class="c1">#                     Acc=self.accessions[&#39;time array&#39;]</span>
            <span class="c1">#             ),</span>
            <span class="c1">#     &#39;i&#39;       : &quot;{ns}binaryDataArrayList/&quot; \</span>
            <span class="c1">#                 &quot;{ns}binaryDataArray/&quot; \</span>
            <span class="c1">#                 &quot;{ns}cvParam[@accession=&#39;{Acc}&#39;]/..&quot;.format(</span>
            <span class="c1">#                         ns=self.ns,</span>
            <span class="c1">#                         Acc=self.accessions[&#39;intensity array&#39;]</span>
            <span class="c1">#                 ),</span>
            <span class="c1">#     &#39;time&#39;    : &quot;{ns}binaryDataArrayList/&quot; \</span>
            <span class="c1">#                 &quot;{ns}binaryDataArray/&quot; \</span>
            <span class="c1">#                 &quot;{ns}cvParam[@accession=&#39;{Acc}&#39;]/..&quot;.format(</span>
            <span class="c1">#                         ns=self.ns,</span>
            <span class="c1">#                         Acc=self.accessions[&#39;time array&#39;]</span>
            <span class="c1">#                 ),</span>
            <span class="c1">#     &#39;float_type&#39; : &quot;./{ns}cvParam[@accession=&#39;{Acc}&#39;]&quot;</span>
            <span class="c1"># }</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_decode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decode_to_numpy</span>
        <span class="c1"># assign function to create numpy array to list???</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;__main__.Chromatogram object with native ID </span><span class="si">{0}</span><span class="s2"> at </span><span class="si">{1}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;__main__.Chromatogram object with native ID </span><span class="si">{0}</span><span class="s2"> at </span><span class="si">{1}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ID</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Chromatogram has no property mz.</span><span class="se">\n</span><span class="s2">Return retention time instead&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the list of time values. If the time values are encoded, the</span>
<span class="sd">        function _decode() is used to decode the encoded data.\n</span>
<span class="sd">        The time property can also be set, e.g. for theoretical data.</span>
<span class="sd">        However, it is recommended to use the profile property to set time and</span>
<span class="sd">        intensity tuples at same time.</span>

<span class="sd">        Returns:</span>
<span class="sd">            time (list): list of time values from the analyzed chromatogram</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_encoding_parameters</span><span class="p">(</span><span class="s2">&quot;time array&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decode</span><span class="p">(</span><span class="o">*</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">i</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_encoding_parameters</span><span class="p">(</span><span class="s2">&quot;intensity array&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decode</span><span class="p">(</span><span class="o">*</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_i</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the list of peaks of the chromatogram as tuples (time, intensity).</span>

<span class="sd">        Returns:</span>
<span class="sd">            peaks (list): list of time, i tuples</span>

<span class="sd">        Example:</span>

<span class="sd">        &gt;&gt;&gt; import pymzml</span>
<span class="sd">        &gt;&gt;&gt; run = pymzml.run.Reader(</span>
<span class="sd">        ...     spectra.mzMl.gz,</span>
<span class="sd">        ...     MS_precisions = {</span>
<span class="sd">        ...         1 : 5e-6,</span>
<span class="sd">        ...         2 : 20e-6</span>
<span class="sd">        ...     }</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; for entry in run:</span>
<span class="sd">        ...     if isinstance(entry, pymzml.spec.Chromatogram):</span>
<span class="sd">        ...         for time, intensity in entry.peaks:</span>
<span class="sd">        ...             print(time, intensity)</span>

<span class="sd">        Note:</span>
<span class="sd">           The peaks property can also be set, e.g. for theoretical data.</span>
<span class="sd">           It requires a list of time/intensity tuples.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">[</span><span class="n">pos</span><span class="p">]])</span>
                    <span class="c1"># much faster than zip ... list(zip(self.mz, self.i))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">[</span><span class="n">pos</span><span class="p">]])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_profile</span><span class="p">)</span>

    <span class="nd">@profile</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tuple_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tuple_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># self._mz, self._i = map(list, zip(*tuple_list))</span>
        <span class="c1"># same here .. zip is soooooo slow :)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_i</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">time</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tuple_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_i</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_peaks</span> <span class="o">=</span> <span class="n">tuple_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reprofiledPeaks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_centroidedPeaks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="Chromatogram.peaks">
<a class="viewcode-back" href="../../pymzml_spec.html#pymzml.spec.Chromatogram.peaks">[docs]</a>
    <span class="k">def</span> <span class="nf">peaks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the list of peaks of the spectrum as tuples (time, intensity).</span>

<span class="sd">        Returns:</span>
<span class="sd">            peaks (list): list of time, intensity tuples</span>

<span class="sd">        Example:</span>

<span class="sd">        &gt;&gt;&gt; import pymzml</span>
<span class="sd">        &gt;&gt;&gt; run = pymzml.run.Reader(</span>
<span class="sd">        ...     spectra.mzMl.gz,</span>
<span class="sd">        ...     MS_precisions =  {</span>
<span class="sd">        ...         1 : 5e-6,</span>
<span class="sd">        ...         2 : 20e-6</span>
<span class="sd">        ...     }</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; for entry in run:</span>
<span class="sd">        ...     if isinstance(entry, pymzml.spec.Chromatogram):</span>
<span class="sd">        ...         for time, intensity in entry.peaks:</span>
<span class="sd">        ...             print(time, intensity)</span>

<span class="sd">        Note:</span>
<span class="sd">           The peaks property can also be set, e.g. for theoretical data.</span>
<span class="sd">           It requires a list of time/intensity tuples.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Kösters, M., Leufken, J., Schulze, S., Sugimoto, K., Zahedi, R. P., Hippler, M., Leidel, S. A. and Fufezan, C..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>